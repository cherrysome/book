<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ì†Œ ëŒ€ê´€ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Canva í˜¸í™˜ì„± ì•ˆë‚´ ì„¹ì…˜ -->
        <div class="bg-gradient-to-r from-blue-100 to-green-100 border border-blue-200 rounded-lg p-6 mb-6">
            <div class="text-center">
                <h2 class="text-2xl font-bold text-blue-800 mb-3">ğŸ¯ ì˜ˆì•½ ì‹œìŠ¤í…œ ì‚¬ìš© ì•ˆë‚´</h2>
                
                <!-- í™˜ê²½ ê°ì§€ ë° ì•ˆë‚´ -->
                <div id="environmentInfo" class="mb-4">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
                
                <!-- ì§ì ‘ ì˜ˆì•½ ë²„íŠ¼ (Canva ì™¸ë¶€ì—ì„œë§Œ í‘œì‹œ) -->
                <div id="directReservationSection" style="display: none;">
                    <p class="text-blue-700 mb-4">ë°”ë¡œ ì—¬ê¸°ì„œ ì˜ˆì•½í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
                    <button onclick="scrollToReservation()" 
                            class="bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700 text-white px-8 py-4 rounded-xl text-xl font-bold shadow-lg transform hover:scale-105 transition-all duration-200 mb-4">
                        ğŸ“… ë°”ë¡œ ì˜ˆì•½í•˜ê¸°
                    </button>
                </div>
                
                <!-- Canva ë‚´ë¶€ì—ì„œì˜ ì•ˆë‚´ -->
                <div id="canvaInstructions" style="display: none;">
                    <p class="text-purple-700 mb-4">Canvaì—ì„œëŠ” ë³´ì•ˆìƒ ì§ì ‘ ì˜ˆì•½ì´ ì œí•œë©ë‹ˆë‹¤.</p>
                    
                    <!-- ë…ë¦½ í˜ì´ì§€ ë§í¬ -->
                    <div class="bg-white rounded-lg p-4 border border-purple-200 mb-4">
                        <h3 class="font-bold text-purple-800 mb-2">ğŸ”— ë…ë¦½ ì˜ˆì•½ í˜ì´ì§€</h3>
                        <p class="text-sm text-purple-700 mb-3">ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ìƒˆ íƒ­ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”:</p>
                        <div class="bg-gray-100 p-3 rounded border text-sm font-mono break-all">
                            <span id="currentPageUrl"></span>
                        </div>
                        <button onclick="copyCurrentUrl()" 
                                class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded mt-2 text-sm transition-colors">
                            ğŸ“‹ ë§í¬ ë³µì‚¬
                        </button>
                    </div>
                    
                    <!-- ì‚¬ìš©ë²• ì•ˆë‚´ -->
                    <div class="bg-white rounded-lg p-4 border border-purple-200">
                        <h3 class="font-bold text-purple-800 mb-2">ğŸ“‹ ì‚¬ìš© ë°©ë²•:</h3>
                        <div class="text-left text-sm text-purple-700 space-y-2">
                            <div class="flex items-start">
                                <span class="bg-purple-200 text-purple-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                                <span>ìœ„ì˜ ë§í¬ë¥¼ ë³µì‚¬</span>
                            </div>
                            <div class="flex items-start">
                                <span class="bg-purple-200 text-purple-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                                <span>ìƒˆ íƒ­ì—ì„œ ë§í¬ ì—´ê¸°</span>
                            </div>
                            <div class="flex items-start">
                                <span class="bg-purple-200 text-purple-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                                <span>ë…ë¦½ í˜ì´ì§€ì—ì„œ ì˜ˆì•½ ì§„í–‰</span>
                            </div>
                        </div>
                        
                        <!-- íŠ¹ë³„ ì•ˆë‚´: Canva ì„ë² ë“œ URLì¸ ê²½ìš° -->
                        <div id="embedUrlNotice" class="mt-3 bg-orange-50 border border-orange-200 rounded-lg p-3" style="display: none;">
                            <p class="text-orange-800 text-xs font-bold mb-1">âš ï¸ ì„ë² ë“œ URL ê°ì§€ë¨</p>
                            <p class="text-orange-700 text-xs">
                                í˜„ì¬ URLì´ Canva ì„ë² ë“œ í˜•íƒœì…ë‹ˆë‹¤.<br>
                                ìœ„ì˜ ë³€í™˜ëœ ë…ë¦½ URLì„ ì‚¬ìš©í•˜ê±°ë‚˜, Canvaì—ì„œ "ì›¹ì‚¬ì´íŠ¸ ê²Œì‹œ" ê¸°ëŠ¥ì„ ì´ìš©í•´ì£¼ì„¸ìš”.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- ê¸°ìˆ ì  í•œê³„ ì„¤ëª… -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4">
                    <p class="text-yellow-800 text-sm">
                        ğŸ’¡ <strong>ê¸°ìˆ ì  ì•ˆë‚´:</strong> Canvaì˜ ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•´ ë‚´ë¶€ì—ì„œëŠ” ì™¸ë¶€ API ì—°ê²°ì´ ì œí•œë©ë‹ˆë‹¤.<br>
                        ë…ë¦½ í˜ì´ì§€ì—ì„œëŠ” ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!
                    </p>
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ì „ìš© êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ ì„¤ì • -->
        <div id="googleSheetSection" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6" style="display: none;">
            <h3 class="text-lg font-semibold text-blue-800 mb-3">ğŸ”— êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ ì„¤ì • (ê´€ë¦¬ì ì „ìš©)</h3>
            
            <!-- ë‹¨ê³„ë³„ ì•ˆë‚´ -->
            <div class="bg-white rounded-lg p-4 mb-4 border border-blue-200">
                <h4 class="font-semibold text-blue-800 mb-2">ğŸ“‹ ì„¤ì • ë°©ë²•:</h4>
                <ol class="text-sm text-blue-700 space-y-1 list-decimal list-inside">
                    <li><strong>êµ¬ê¸€ ì‹œíŠ¸ ì—´ê¸°:</strong> <a href="https://docs.google.com/spreadsheets/d/1FDCPdhGcVUoBxK9T4kb1YeVJCCnrOXj05kyTCfO8Zqs/edit" target="_blank" class="text-blue-600 underline hover:text-blue-800">ì—¬ê¸°ë¥¼ í´ë¦­</a></li>
                    <li><strong>Apps Script ì—´ê¸°:</strong> í™•ì¥ í”„ë¡œê·¸ë¨ â†’ Apps Script í´ë¦­</li>
                    <li><strong>ì½”ë“œ ë¶™ì—¬ë„£ê¸°:</strong> ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°</li>
                    <li><strong>ë°°í¬í•˜ê¸°:</strong> ë°°í¬ â†’ ìƒˆ ë°°í¬ â†’ ì›¹ ì•±ìœ¼ë¡œ ë°°í¬</li>
                    <li><strong>URL ë³µì‚¬:</strong> ìƒì„±ëœ ì›¹ì•± URLì„ ì•„ë˜ì— ì…ë ¥</li>
                </ol>
                
                <!-- Canva/Netlify íŠ¹ë³„ ìš”êµ¬ì‚¬í•­ -->
                <div class="bg-yellow-50 border border-yellow-300 rounded-lg p-3 mt-3">
                    <h5 class="font-bold text-yellow-800 mb-2">ğŸš¨ Canva/Netlify í™˜ê²½ í•„ìˆ˜ ìš”êµ¬ì‚¬í•­</h5>
                    <div class="text-yellow-700 text-sm space-y-2">
                        <div class="flex items-start">
                            <span class="bg-yellow-200 text-yellow-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                            <div>
                                <p class="font-semibold">HTTPS ì›¹ì•±ìœ¼ë¡œ ë°°í¬ í•„ìˆ˜</p>
                                <p class="text-xs">HTTPëŠ” ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°˜ë“œì‹œ https://script.google.com/... URLì´ì–´ì•¼ í•¨</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <span class="bg-yellow-200 text-yellow-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                            <div>
                                <p class="font-semibold">ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì" (Anyone) í•„ìˆ˜</p>
                                <p class="text-xs">ìµëª… ì‚¬ìš©ì ì ‘ê·¼ì´ í—ˆìš©ë˜ì–´ì•¼ Canva/Netlifyì—ì„œ ì‘ë™</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <span class="bg-yellow-200 text-yellow-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                            <div>
                                <p class="font-semibold">ìµœì í™”ëœ ì½”ë“œ ì‚¬ìš©</p>
                                <p class="text-xs">CORS í—¤ë” ì œê±°ëœ ContentServiceë§Œ ì‚¬ìš© (ìœ„ ì½”ë“œ ì ìš©)</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- iframe ì œí•œ ê²½ê³  -->
                    <div class="bg-red-50 border border-red-300 rounded-lg p-3 mt-3">
                        <p class="text-red-800 font-bold text-sm mb-1">âš ï¸ iframe í™˜ê²½ ì œí•œì‚¬í•­</p>
                        <p class="text-red-700 text-xs">
                            Google Apps ScriptëŠ” iframe ê¸°ë°˜ í˜¸ìŠ¤íŒ…ì—ì„œ CORSë¥¼ ì™„ë²½íˆ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                            <strong>ë…ë¦½ í˜ì´ì§€ì—ì„œëŠ” ì •ìƒ ì‘ë™</strong>í•˜ì§€ë§Œ, <strong>Canva ë‚´ë¶€ì—ì„œëŠ” ë¶ˆì•ˆì •</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                            ìµœìƒì˜ ê²½í—˜ì„ ìœ„í•´ì„œëŠ” "ì›¹ì‚¬ì´íŠ¸ ê²Œì‹œ" ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì„¸ìš”.
                        </p>
                    </div>
                </div>
            </div>

            <!-- ì˜¤ë¥˜ í•´ê²° ì•ˆë‚´ -->
            <div class="bg-red-50 border border-red-300 rounded-lg p-4 mb-4">
                <h4 class="font-bold text-red-800 mb-2">ğŸš¨ ì—°ê²° ì˜¤ë¥˜ í•´ê²° ë°©ë²•</h4>
                <div class="text-red-700 text-sm space-y-3">
                    
                    <!-- Failed to fetch ì˜¤ë¥˜ -->
                    <div class="bg-orange-100 border border-orange-300 rounded p-3">
                        <p class="font-bold text-orange-800 mb-1">ğŸ”¥ "Failed to fetch" ì˜¤ë¥˜ (ê°€ì¥ í”í•œ ì˜¤ë¥˜):</p>
                        <p class="text-orange-700 mb-2">ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. Canva/Netlify í™˜ê²½ì—ì„œëŠ” CORS ì œí•œì´ ë” ì—„ê²©í•©ë‹ˆë‹¤.</p>
                        <div class="bg-white border border-orange-200 rounded p-2 mt-2">
                            <p class="font-bold text-orange-800 text-xs mb-1">âœ… Canva/Netlify íŠ¹í™” í•´ê²°ë²•:</p>
                            <ul class="list-disc list-inside text-orange-700 text-xs space-y-1">
                                <li><strong>1ë‹¨ê³„:</strong> ìœ„ì˜ ìµœì í™”ëœ ì½”ë“œ ì‚¬ìš© (CORS í—¤ë” ì œê±°ë¨)</li>
                                <li><strong>2ë‹¨ê³„:</strong> Apps Scriptì—ì„œ ê¸°ì¡´ ë°°í¬ ëª¨ë‘ ì‚­ì œ</li>
                                <li><strong>3ë‹¨ê³„:</strong> ìƒˆ ë°°í¬ ìƒì„± ì‹œ "ì•¡ì„¸ìŠ¤ ê¶Œí•œ: ëª¨ë“  ì‚¬ìš©ì" í•„ìˆ˜!</li>
                                <li><strong>4ë‹¨ê³„:</strong> ê¶Œí•œ ìŠ¹ì¸ ì‹œ "ê³ ê¸‰" â†’ "ì•ˆì „í•˜ì§€ ì•Šì€ í˜ì´ì§€ë¡œ ì´ë™" í´ë¦­</li>
                                <li><strong>5ë‹¨ê³„:</strong> iframe í™˜ê²½ì—ì„œëŠ” ì—¬ì „íˆ ë¶ˆì•ˆì •í•  ìˆ˜ ìˆìŒ</li>
                            </ul>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded p-2 mt-2">
                            <p class="text-yellow-800 text-xs font-bold">âš ï¸ ì¤‘ìš” ì•ˆë‚´:</p>
                            <p class="text-yellow-700 text-xs">
                                Google Apps ScriptëŠ” iframe ê¸°ë°˜ í˜¸ìŠ¤íŒ…(Canva ë“±)ì—ì„œ CORSë¥¼ ì™„ë²½íˆ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                                ë…ë¦½ í˜ì´ì§€ì—ì„œëŠ” ì •ìƒ ì‘ë™í•˜ì§€ë§Œ, Canva ë‚´ë¶€ì—ì„œëŠ” ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-100 border border-yellow-300 rounded p-3">
                        <p class="font-bold text-yellow-800 mb-1">âš ï¸ 302 ì˜¤ë¥˜ (ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸):</p>
                        <p class="text-yellow-700">Apps Scriptê°€ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë°°í¬ ì„¤ì •ì´ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    
                    <p><strong>ğŸ”§ í•´ê²° ë°©ë²• (ìˆœì„œëŒ€ë¡œ ì§„í–‰):</strong></p>
                    
                    <div class="bg-white border border-red-200 rounded p-3">
                        <p class="font-bold text-red-800 mb-2">1ï¸âƒ£ ê¸°ì¡´ ë°°í¬ ì™„ì „ ì‚­ì œ</p>
                        <ul class="list-disc list-inside ml-4 space-y-1 text-red-600">
                            <li>Apps Scriptì—ì„œ "ë°°í¬" â†’ "ë°°í¬ ê´€ë¦¬" í´ë¦­</li>
                            <li>ê¸°ì¡´ ë°°í¬ê°€ ìˆë‹¤ë©´ <strong>ëª¨ë‘ ì‚­ì œ</strong> (ğŸ—‘ï¸ ì•„ì´ì½˜ í´ë¦­)</li>
                            <li>âš ï¸ ì´ ë‹¨ê³„ë¥¼ ê±´ë„ˆë›°ë©´ 302 ì˜¤ë¥˜ê°€ ê³„ì† ë°œìƒí•©ë‹ˆë‹¤!</li>
                        </ul>
                    </div>
                    
                    <div class="bg-white border border-red-200 rounded p-3">
                        <p class="font-bold text-red-800 mb-2">2ï¸âƒ£ ìƒˆ ë°°í¬ ë§Œë“¤ê¸° (Canva/Netlify íŠ¹í™”)</p>
                        <ul class="list-disc list-inside ml-4 space-y-1 text-red-600">
                            <li>"ë°°í¬" â†’ "ìƒˆ ë°°í¬" í´ë¦­</li>
                            <li>âš™ï¸ ì„¤ì • ì•„ì´ì½˜ í´ë¦­ â†’ "ì›¹ ì•±" ì„ íƒ</li>
                            <li><span class="bg-yellow-200 px-2 py-1 rounded font-bold">ì‹¤í–‰ ê¶Œí•œ: "ë‚˜"</span></li>
                            <li><span class="bg-green-200 px-2 py-1 rounded font-bold">ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì"</span> â­ Canva/Netlify í•„ìˆ˜!</li>
                            <li><span class="bg-blue-200 px-2 py-1 rounded font-bold">HTTPS ì›¹ì•± URL í™•ì¸</span> (https://script.google.com/...)</li>
                            <li>"ë°°í¬" ë²„íŠ¼ í´ë¦­</li>
                            <li>ğŸ” ê¶Œí•œ ìŠ¹ì¸ í™”ë©´ì—ì„œ "ê³ ê¸‰" â†’ "ì•ˆì „í•˜ì§€ ì•Šì€ í˜ì´ì§€ë¡œ ì´ë™" í´ë¦­</li>
                            <li>ëª¨ë“  ê¶Œí•œ í—ˆìš© (ìµëª… ì‚¬ìš©ì ì ‘ê·¼ í¬í•¨)</li>
                        </ul>
                        
                        <div class="bg-orange-50 border border-orange-200 rounded p-2 mt-2">
                            <p class="text-orange-800 text-xs font-bold">ğŸš¨ Canva/Netlify í™˜ê²½ ì£¼ì˜ì‚¬í•­:</p>
                            <p class="text-orange-700 text-xs">
                                â€¢ "ëª¨ë“  ì‚¬ìš©ì" ê¶Œí•œì´ ì—†ìœ¼ë©´ CORS ì˜¤ë¥˜ ë°œìƒ<br>
                                â€¢ HTTP URLì€ ì ˆëŒ€ ì‘ë™í•˜ì§€ ì•ŠìŒ (HTTPS í•„ìˆ˜)<br>
                                â€¢ Content-Type: application/json í—¤ë” í•„ìˆ˜
                            </p>
                        </div>
                    </div>
                    
                    <div class="bg-white border border-red-200 rounded p-3">
                        <p class="font-bold text-red-800 mb-2">3ï¸âƒ£ ì¤‘ìš”í•œ í™•ì¸ì‚¬í•­</p>
                        <ul class="list-disc list-inside ml-4 space-y-1 text-red-600">
                            <li>ë°°í¬ í›„ ìƒì„±ëœ URLì´ <code>https://script.google.com/macros/s/...</code> í˜•íƒœì¸ì§€ í™•ì¸</li>
                            <li>êµ¬ê¸€ ì‹œíŠ¸ URLì´ ì•„ë‹Œ <strong>ì›¹ì•± URL</strong>ì„ ì‚¬ìš©í•´ì•¼ í•¨</li>
                            <li>ë°°í¬ ì‹œ "ìƒˆ ë²„ì „" ìƒì„± í™•ì¸</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Apps Script ì½”ë“œ -->
            <div class="bg-gray-50 rounded-lg p-3 mb-4 border">
                <div class="flex justify-between items-center mb-2">
                    <h4 class="font-semibold text-gray-800">ğŸ“ ìµœì‹  Apps Script ì½”ë“œ (CORS í•´ê²°):</h4>
                    <button onclick="copyAppsScriptCode()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                        ğŸ“‹ ë³µì‚¬
                    </button>
                </div>
                <textarea id="appsScriptCode" readonly class="w-full h-40 text-xs font-mono bg-white border rounded p-2 resize-none">// ğŸš¨ Canva/Netlify í™˜ê²½ ìµœì í™” ì½”ë“œ
// 1. HTTPS ì›¹ì•±ìœ¼ë¡œ ë°°í¬ (HTTP ë¶ˆê°€)
// 2. ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì" (Anyone) í•„ìˆ˜
// 3. ContentServiceë§Œ ì‚¬ìš© (CORS í—¤ë” ì œê±°ë¡œ ì•ˆì •ì„± í–¥ìƒ)

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('ì‹œíŠ¸1'); // ì‹œíŠ¸ ì´ë¦„ ì •í™•íˆ ì…ë ¥
    
    if (data.reservations && Array.isArray(data.reservations)) {
      // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ í›„ ìƒˆ ë°ì´í„° ì…ë ¥
      sheet.clearContents();
      sheet.appendRow(['ë‚ ì§œ', 'ì‹œê°„', 'ì˜ˆì•½ì']); // í—¤ë” ì¶”ê°€
      
      // ì˜ˆì•½ ë°ì´í„° ì¶”ê°€
      data.reservations.forEach(row => {
        if (row && row.length >= 3) {
          sheet.appendRow(row);
        }
      });
      
      // ì„±ê³µ ì‘ë‹µ (JSON í˜•íƒœë¡œ ë°˜í™˜)
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: true, 
          saved: data.reservations.length,
          timestamp: new Date().toISOString()
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'No valid reservations data found' 
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (err) {
    // ì˜¤ë¥˜ ë°œìƒ ì‹œ
    console.error('doPost ì˜¤ë¥˜:', err);
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: err.message,
        timestamp: new Date().toISOString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('ì‹œíŠ¸1');
    
    // ì‹œíŠ¸ì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
    const lastRow = sheet.getLastRow();
    if (lastRow <= 1) {
      // í—¤ë”ë§Œ ìˆê±°ë‚˜ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°
      return ContentService
        .createTextOutput(JSON.stringify([]))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    // í—¤ë” ì œì™¸í•˜ê³  ë°ì´í„°ë§Œ ê°€ì ¸ì˜¤ê¸°
    const data = sheet.getRange(2, 1, lastRow - 1, 3).getValues();
    
    // ë¹ˆ í–‰ ì œê±°
    const filteredData = data.filter(row => 
      row[0] && row[1] && row[2] && 
      row[0].toString().trim() !== '' && 
      row[1].toString().trim() !== '' && 
      row[2].toString().trim() !== ''
    );
    
    return ContentService
      .createTextOutput(JSON.stringify(filteredData))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (err) {
    console.error('doGet ì˜¤ë¥˜:', err);
    return ContentService
      .createTextOutput(JSON.stringify({ 
        error: err.message,
        timestamp: new Date().toISOString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}</textarea>
            </div>

            <!-- URL ì…ë ¥ -->
            <div class="flex flex-col md:flex-row gap-3 items-center">
                <input type="url" id="googleSheetUrl" placeholder="Apps Script ì›¹ì•± URLì„ ì…ë ¥í•˜ì„¸ìš” (https://script.google.com/...)" 
                       class="flex-1 px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button onclick="connectGoogleSheet()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                    ì—°ê²° í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="loadFromGoogleSheet()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                    ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
            </div>
            
            <!-- ì—°ê²° ìƒíƒœ ë° ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
            <div class="mt-2 text-sm">
                <p id="connectionStatus" class="text-red-700 font-medium">âŒ êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ì•ˆë¨ - ë¡œì»¬ ì €ì¥ë§Œ ê°€ëŠ¥</p>
                <p class="text-xs mt-1 text-blue-600">ğŸ’¡ Apps Script ì›¹ì•± URLì´ í•„ìš”í•©ë‹ˆë‹¤ (êµ¬ê¸€ ì‹œíŠ¸ URLì´ ì•„ë‹˜)</p>
                
                <!-- ì—°ê²° ì‹¤íŒ¨ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                <div id="troubleshootingChecklist" class="mt-3 bg-orange-50 border border-orange-200 rounded-lg p-3" style="display: none;">
                    <p class="font-bold text-orange-800 text-sm mb-2">ğŸ” ì—°ê²° ì‹¤íŒ¨ ì²´í¬ë¦¬ìŠ¤íŠ¸:</p>
                    <div class="text-orange-700 text-xs space-y-1">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="mr-2 text-orange-600"> 
                            <span>Apps Script ì½”ë“œë¥¼ ì •í™•íˆ ë³µì‚¬í–ˆë‚˜ìš”?</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="mr-2 text-orange-600"> 
                            <span>ê¸°ì¡´ ë°°í¬ë¥¼ ëª¨ë‘ ì‚­ì œí–ˆë‚˜ìš”?</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="mr-2 text-orange-600"> 
                            <span>ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ "ëª¨ë“  ì‚¬ìš©ì"ë¡œ ì„¤ì •í–ˆë‚˜ìš”?</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="mr-2 text-orange-600"> 
                            <span>ê¶Œí•œ ìŠ¹ì¸ì—ì„œ "ê³ ê¸‰" â†’ "ì•ˆì „í•˜ì§€ ì•Šì€ í˜ì´ì§€ë¡œ ì´ë™"ì„ í´ë¦­í–ˆë‚˜ìš”?</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="mr-2 text-orange-600"> 
                            <span>ì›¹ì•± URLì„ ì‚¬ìš©í•˜ê³  ìˆë‚˜ìš”? (êµ¬ê¸€ ì‹œíŠ¸ URLì´ ì•„ë‹Œ)</span>
                        </label>
                    </div>
                    <p class="text-orange-600 text-xs mt-2 font-medium">
                        âœ… ëª¨ë“  í•­ëª©ì„ ì²´í¬í•œ í›„ ë‹¤ì‹œ ì—°ê²° í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì„¸ìš”!
                    </p>
                </div>
            </div>
        </div>

        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ† ëŒ€íšŒì „ ë©˜í† ë§ ì˜ˆì•½</h1>
            <p class="text-gray-600">2025ë…„ 8ì›” 10ì¼ ~ 9ì›” 2ì¼ | ì˜¤ì „ 10ì‹œ ~ ì˜¤í›„ 7ì‹œ</p>
            <div class="mt-4 text-sm text-gray-700 space-y-2">
                <div class="bg-blue-50 p-3 rounded-lg">
                    <p class="mb-1">ğŸ“ <strong>ë©˜í† ë§ì¥:</strong> ì•ˆì–‘ì‹œ ì¸ì¬ìœ¡ì„±ì¬ë‹¨ 1ì¸µ &lt;ì‚°í† ë¦¬ë‹ˆ&gt; ê°•ì˜ì‹¤</p>
                    <p class="text-xs text-gray-600">(ì¬ë‹¨ì€ ê²Œì„ë§ˆì—ìŠ¤í„°ê³ ë“±í•™êµ ìƒ›ë³„ê´€ì— ìˆìŠµë‹ˆë‹¤.)</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <div class="text-center mb-3">
                        <h3 class="text-lg font-bold text-green-800 mb-1">ğŸŸï¸ ëŒ€íšŒ ìš´ì˜ ì•ˆë‚´</h3>
                        <div class="w-16 h-0.5 bg-green-400 mx-auto"></div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-center bg-white rounded-lg p-2 shadow-sm">
                            <span class="text-green-700 font-medium">ğŸ“ ì¥ì†Œ: </span>
                            <span class="ml-2 font-semibold text-gray-800">í‰ì´Œ ì¤‘ì•™ê³µì›</span>
                        </div>
                        <div class="bg-white rounded-lg p-3 shadow-sm">
                            <p class="text-green-700 font-medium text-center mb-2">â° ê²½ê¸° ì‹œê°„</p>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="bg-blue-50 rounded-lg p-2 text-center border border-blue-200">
                                    <div class="text-blue-700 font-semibold text-sm">ì´ˆë“±ë¶€</div>
                                    <div class="text-blue-800 font-bold">12:00 - 13:00</div>
                                </div>
                                <div class="bg-purple-50 rounded-lg p-2 text-center border border-purple-200">
                                    <div class="text-purple-700 font-semibold text-sm">ê³ ë“±ë¶€</div>
                                    <div class="text-purple-800 font-bold">15:00 - 18:00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë‚ ì§œ ì„ íƒ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">ğŸ“… ë‚ ì§œ ì„ íƒ</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2" id="dateSelector">
                <!-- ë‚ ì§œ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì‹œê°„í‘œ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800 mb-2 md:mb-0">â° ì‹œê°„ë³„ ì˜ˆì•½ í˜„í™©</h2>
                <div class="bg-red-50 border border-red-200 rounded-lg px-4 py-2">
                    <p class="text-red-700 text-sm font-medium">âš ï¸ ì˜ˆì•½í›„ì—ëŠ” ìˆ˜ì •ì´ ì•ˆë©ë‹ˆë‹¤. ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš° ë‹¨í†¡ìœ¼ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”</p>
                </div>
            </div>
            <div class="text-center mb-4">
                <span class="text-lg font-medium text-blue-600" id="selectedDateDisplay">ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-2 text-left font-semibold text-gray-700">ì‹œê°„</th>
                            <th class="border border-gray-300 px-4 py-2 text-left font-semibold text-gray-700">ì˜ˆì•½ì</th>
                        </tr>
                    </thead>
                    <tbody id="timeTable">
                        <!-- ì‹œê°„í‘œê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ëª¨ë“œ ë²„íŠ¼ -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="text-center">
                <button id="adminModeBtn" onclick="toggleAdminMode()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg text-lg font-medium transition-colors">
                    ğŸ” ê´€ë¦¬ì ëª¨ë“œ
                </button>
                <p class="text-sm text-gray-600 mt-2">ê´€ë¦¬ì ê¸°ëŠ¥ ë° êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™</p>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì•½ ëª¨ë‹¬ -->
    <div id="reservationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 mx-4">
            <h3 class="text-lg font-semibold mb-4 text-gray-800">ì˜ˆì•½í•˜ê¸°</h3>
            <form onsubmit="event.preventDefault(); confirmReservation();">
                <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-3">ì„ íƒí•œ ì‹œê°„: <span id="modalTimeSlot" class="font-medium"></span></p>
                    
                    <!-- í•™ê¸‰ ì„ íƒ -->
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">í•™ê¸‰ ì„ íƒ</label>
                        <div class="flex gap-3">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="grade" value="ì´ˆë“±" id="elementary" class="mr-2 text-blue-600 focus:ring-blue-500">
                                <span class="text-blue-700 font-medium">ğŸ’ ì´ˆë“±ë¶€</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="grade" value="ê³ ë“±" id="highschool" class="mr-2 text-purple-600 focus:ring-purple-500">
                                <span class="text-purple-700 font-medium">ğŸ“ ê³ ë“±ë¶€</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- ì´ë¦„ ì…ë ¥ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„</label>
                        <input type="text" id="nameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
                        ì˜ˆì•½í•˜ê¸°
                    </button>
                    <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors">
                        ì·¨ì†Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 mx-4">
            <h3 class="text-lg font-semibold mb-4 text-gray-800">ì˜ˆì•½ ìˆ˜ì •/ì‚­ì œ</h3>
            <form onsubmit="event.preventDefault();">
                <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-2">í˜„ì¬ ì˜ˆì•½ì: <span id="currentReserver" class="font-medium"></span></p>
                    <input type="password" id="passwordInput" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3">
                    <input type="text" id="newNameInput" placeholder="ìƒˆ ì´ë¦„ (ìˆ˜ì •ì‹œì—ë§Œ)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex gap-2">
                    <button type="button" onclick="updateReservation()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors">
                        ìˆ˜ì •
                    </button>
                    <button type="button" onclick="deleteReservation()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors">
                        ì‚­ì œ
                    </button>
                    <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors">
                        ì·¨ì†Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
    <div id="adminPasswordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 mx-4">
            <h3 class="text-lg font-semibold mb-4 text-gray-800">ê´€ë¦¬ì ì¸ì¦</h3>
            <form onsubmit="event.preventDefault(); checkAdminPassword();">
                <div class="mb-4">
                    <input type="password" id="adminPasswordInput" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
                        í™•ì¸
                    </button>
                    <button type="button" onclick="closeAdminPasswordModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors">
                        ì·¨ì†Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 mx-4">
            <h3 class="text-lg font-semibold mb-4 text-gray-800">í™•ì¸</h3>
            <p id="confirmMessage" class="text-gray-600 mb-6"></p>
            <div class="flex gap-2">
                <button id="confirmYes" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors">
                    í™•ì¸
                </button>
                <button id="confirmNo" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let reservations = {};
        let disabledSlots = {};
        let selectedDate = '';
        let selectedTimeSlot = '';
        let isAdminMode = false;
        let googleSheetUrl = '';
        let isConnected = false;
        const PASSWORD = '1234';

        // í™˜ê²½ ê°ì§€ ë° UI ì„¤ì •
        function detectEnvironmentAndSetupUI() {
            const isInCanva = window.location.hostname.includes('canva.site') || 
                             window.location.hostname.includes('canva.com') ||
                             window.parent !== window || // iframe ë‚´ë¶€
                             document.referrer.includes('canva');
            
            const environmentInfo = document.getElementById('environmentInfo');
            const directSection = document.getElementById('directReservationSection');
            const canvaInstructions = document.getElementById('canvaInstructions');
            const currentPageUrl = document.getElementById('currentPageUrl');
            
            if (isInCanva) {
                // Canva í™˜ê²½
                environmentInfo.innerHTML = `
                    <div class="bg-purple-100 border border-purple-300 rounded-lg p-3">
                        <p class="text-purple-800 font-medium">ğŸ¨ Canva í™˜ê²½ì—ì„œ ì‹¤í–‰ ì¤‘</p>
                    </div>
                `;
                canvaInstructions.style.display = 'block';
                directSection.style.display = 'none';
                
                // í˜„ì¬ í˜ì´ì§€ URL í‘œì‹œ (ë…ë¦½ í˜ì´ì§€ìš©)
                // Canva ì„ë² ë“œ URLì„ ë…ë¦½ í˜ì´ì§€ URLë¡œ ë³€í™˜
                let independentUrl = window.location.href;
                
                // Canva ì„ë² ë“œ URL íŒ¨í„´ ê°ì§€ ë° ë³€í™˜
                if (independentUrl.includes('canva-hosted-embed.com')) {
                    // ì„ë² ë“œ URLì—ì„œ ë…ë¦½ í˜ì´ì§€ URL ì¶”ì¶œ ì‹œë„
                    const urlParts = independentUrl.split('/');
                    const codeId = urlParts[urlParts.length - 2]; // codelet ID ì¶”ì¶œ
                    
                    // ë…ë¦½ í˜ì´ì§€ URL ìƒì„± (ì˜ˆìƒ íŒ¨í„´)
                    independentUrl = `https://${codeId.substring(0, 16)}.canva.site/`;
                    
                    console.log('Canva ì„ë² ë“œ URL ê°ì§€:', window.location.href);
                    console.log('ë³€í™˜ëœ ë…ë¦½ URL:', independentUrl);
                }
                
                if (currentPageUrl) {
                    currentPageUrl.textContent = independentUrl;
                }
                
                // ì„ë² ë“œ URLì¸ ê²½ìš° íŠ¹ë³„ ì•ˆë‚´ í‘œì‹œ
                if (window.location.href.includes('canva-hosted-embed.com')) {
                    const embedNotice = document.getElementById('embedUrlNotice');
                    if (embedNotice) {
                        embedNotice.style.display = 'block';
                    }
                }
            } else {
                // ë…ë¦½ í™˜ê²½
                environmentInfo.innerHTML = `
                    <div class="bg-green-100 border border-green-300 rounded-lg p-3">
                        <p class="text-green-800 font-medium">âœ… ë…ë¦½ í˜ì´ì§€ì—ì„œ ì‹¤í–‰ ì¤‘ - ëª¨ë“  ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥!</p>
                    </div>
                `;
                directSection.style.display = 'block';
                canvaInstructions.style.display = 'none';
            }
            
            return !isInCanva; // ë…ë¦½ í™˜ê²½ì´ë©´ true ë°˜í™˜
        }
        
        // ì˜ˆì•½ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
        function scrollToReservation() {
            const dateSelector = document.getElementById('dateSelector');
            if (dateSelector) {
                dateSelector.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                showAlert('ğŸ“… ë‚ ì§œë¥¼ ì„ íƒí•´ì„œ ì˜ˆì•½ì„ ì‹œì‘í•˜ì„¸ìš”!');
            }
        }
        
        // í˜„ì¬ URL ë³µì‚¬
        function copyCurrentUrl() {
            const url = window.location.href;
            
            // í´ë¦½ë³´ë“œ API ì‚¬ìš© (ìµœì‹  ë¸Œë¼ìš°ì €)
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(url).then(() => {
                    showAlert('âœ… ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìƒˆ íƒ­ì—ì„œ ë¶™ì—¬ë„£ê¸°í•´ì„œ ì—´ì–´ì£¼ì„¸ìš”.');
                }).catch(() => {
                    fallbackCopyUrl(url);
                });
            } else {
                fallbackCopyUrl(url);
            }
        }
        
        // í´ë¦½ë³´ë“œ API ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° ëŒ€ì²´ ë°©ë²•
        function fallbackCopyUrl(url) {
            // ì„ì‹œ í…ìŠ¤íŠ¸ ì˜ì—­ ìƒì„±
            const textArea = document.createElement('textarea');
            textArea.value = url;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showAlert('âœ… ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìƒˆ íƒ­ì—ì„œ ë¶™ì—¬ë„£ê¸°í•´ì„œ ì—´ì–´ì£¼ì„¸ìš”.');
            } catch (err) {
                showAlert('âŒ ìë™ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\në§í¬ë¥¼ ì§ì ‘ ì„ íƒí•´ì„œ ë³µì‚¬í•´ì£¼ì„¸ìš”:\n\n' + url);
            }
            
            document.body.removeChild(textArea);
        }

        // Apps Script ì½”ë“œ ë³µì‚¬
        function copyAppsScriptCode() {
            const textarea = document.getElementById('appsScriptCode');
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showAlert('âœ… Apps Script ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nêµ¬ê¸€ ì‹œíŠ¸ì˜ Apps Scriptì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
            } catch (err) {
                showAlert('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì½”ë“œë¥¼ ì§ì ‘ ì„ íƒí•´ì„œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            }
        }

        // êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° í…ŒìŠ¤íŠ¸
        async function connectGoogleSheet() {
            const url = document.getElementById('googleSheetUrl').value.trim();
            if (!url) {
                showAlert('Apps Script ì›¹ì•± URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // HTTPS ê²€ì¦ (Canva/Netlify í•„ìˆ˜)
            if (!url.startsWith('https://')) {
                showAlert('âŒ HTTPS URLì´ í•„ìš”í•©ë‹ˆë‹¤!\n\nCanva/Netlify í™˜ê²½ì—ì„œëŠ” HTTP URLì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\në°˜ë“œì‹œ https://script.google.com/... í˜•íƒœì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (!url.includes('script.google.com')) {
                showAlert('âŒ ì˜¬ë°”ë¥¸ Apps Script URLì´ ì•„ë‹™ë‹ˆë‹¤.\n\nêµ¬ê¸€ ì‹œíŠ¸ URLì´ ì•„ë‹Œ Apps Script ì›¹ì•± URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n(https://script.google.com/... í˜•íƒœ)');
                return;
            }
            
            // ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘ ì•Œë¦¼
            showAlert('ğŸ”„ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì¤‘...\nì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
            
            try {
                console.log('=== êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
                console.log('í…ŒìŠ¤íŠ¸ URL:', url);
                console.log('ë¸Œë¼ìš°ì €:', navigator.userAgent);
                console.log('í˜„ì¬ ì‹œê°„:', new Date().toISOString());
                
                // 1ë‹¨ê³„: ê¸°ë³¸ ì—°ê²°ì„± í…ŒìŠ¤íŠ¸ (ê°„ë‹¨í•œ GET ìš”ì²­)
                console.log('\n1ë‹¨ê³„: ê¸°ë³¸ ì—°ê²°ì„± í…ŒìŠ¤íŠ¸');
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15ì´ˆ íƒ€ì„ì•„ì›ƒ
                
                const getResponse = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache',
                    redirect: 'follow',
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json, text/plain, */*',
                        'User-Agent': 'Mozilla/5.0 (compatible; ReservationSystem/1.0)'
                    }
                });
                
                clearTimeout(timeoutId);
                
                console.log('âœ… GET ìš”ì²­ ì„±ê³µ');
                console.log('ì‘ë‹µ ìƒíƒœ:', getResponse.status, getResponse.statusText);
                console.log('ì‘ë‹µ URL:', getResponse.url);
                console.log('ì‘ë‹µ í—¤ë”:', Object.fromEntries(getResponse.headers.entries()));
                
                // ì‘ë‹µ ìƒíƒœ í™•ì¸
                if (!getResponse.ok) {
                    throw new Error(`HTTP ${getResponse.status}: ${getResponse.statusText}`);
                }
                
                // ì‘ë‹µ ë‚´ìš© í™•ì¸
                const getResponseText = await getResponse.text();
                console.log('ì‘ë‹µ ë‚´ìš© ê¸¸ì´:', getResponseText.length);
                console.log('ì‘ë‹µ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°:', getResponseText.substring(0, 200));
                
                // JSON íŒŒì‹± ì‹œë„
                let getData;
                try {
                    getData = JSON.parse(getResponseText);
                    console.log('âœ… JSON íŒŒì‹± ì„±ê³µ:', getData);
                } catch (parseError) {
                    console.log('âŒ JSON íŒŒì‹± ì‹¤íŒ¨:', parseError.message);
                    
                    // HTML ì‘ë‹µ í™•ì¸ (ë¡œê·¸ì¸ í˜ì´ì§€ ë“±)
                    if (getResponseText.includes('<html') || getResponseText.includes('<!DOCTYPE')) {
                        throw new Error('PERMISSION_ERROR: HTML ë¡œê·¸ì¸ í˜ì´ì§€ ì‘ë‹µ - ê¶Œí•œ ì„¤ì • í™•ì¸ í•„ìš”');
                    }
                    
                    // ë¹ˆ ì‘ë‹µ í™•ì¸
                    if (getResponseText.trim() === '') {
                        throw new Error('EMPTY_RESPONSE: ë¹ˆ ì‘ë‹µ - Apps Script ì½”ë“œ í™•ì¸ í•„ìš”');
                    }
                    
                    throw new Error(`JSON_PARSE_ERROR: ${parseError.message}`);
                }
                
                // 2ë‹¨ê³„: POST ìš”ì²­ìœ¼ë¡œ ì“°ê¸° ê¶Œí•œ í…ŒìŠ¤íŠ¸
                console.log('\n2ë‹¨ê³„: ì“°ê¸° ê¶Œí•œ í…ŒìŠ¤íŠ¸');
                
                const testData = {
                    reservations: [['2025-08-10', '10:00', 'ì—°ê²°í…ŒìŠ¤íŠ¸_' + Date.now()]]
                };
                
                const postController = new AbortController();
                const postTimeoutId = setTimeout(() => postController.abort(), 15000);
                
                const postResponse = await fetch(url, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    redirect: 'follow',
                    signal: postController.signal,
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json, text/plain, */*',
                        'User-Agent': 'Mozilla/5.0 (compatible; ReservationSystem/1.0)'
                    },
                    body: JSON.stringify(testData)
                });
                
                clearTimeout(postTimeoutId);
                
                console.log('âœ… POST ìš”ì²­ ì„±ê³µ');
                console.log('POST ì‘ë‹µ ìƒíƒœ:', postResponse.status, postResponse.statusText);
                console.log('POST ì‘ë‹µ í—¤ë”:', Object.fromEntries(postResponse.headers.entries()));
                
                if (!postResponse.ok) {
                    throw new Error(`POST_ERROR: HTTP ${postResponse.status} - ${postResponse.statusText}`);
                }
                
                const postResponseText = await postResponse.text();
                console.log('POST ì‘ë‹µ ë‚´ìš©:', postResponseText);
                
                let result;
                try {
                    result = JSON.parse(postResponseText);
                    console.log('âœ… POST JSON íŒŒì‹± ì„±ê³µ:', result);
                } catch (parseError) {
                    console.log('âŒ POST JSON íŒŒì‹± ì‹¤íŒ¨:', parseError.message);
                    
                    if (postResponseText.includes('<html') || postResponseText.includes('<!DOCTYPE')) {
                        throw new Error('PERMISSION_ERROR: POST ìš”ì²­ì—ì„œ HTML ì‘ë‹µ - ê¶Œí•œ ì„¤ì • í™•ì¸ í•„ìš”');
                    }
                    
                    throw new Error(`POST_JSON_PARSE_ERROR: ${parseError.message}`);
                }
                
                // ê²°ê³¼ í™•ì¸
                if (result.success) {
                    console.log('ğŸ‰ ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ì „ ì„±ê³µ!');
                    
                    // ì—°ê²° ì„±ê³µ ì²˜ë¦¬
                    googleSheetUrl = url;
                    localStorage.setItem('googleSheetUrl', url);
                    isConnected = true;
                    
                    document.getElementById('connectionStatus').innerHTML = 'âœ… êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²°ë¨ - ì‹¤ì‹œê°„ ë™ê¸°í™” ê°€ëŠ¥';
                    document.getElementById('connectionStatus').className = 'text-green-700 font-medium';
                    
                    // ì²´í¬ë¦¬ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
                    document.getElementById('troubleshootingChecklist').style.display = 'none';
                    
                    showAlert('ğŸ‰ êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ì™„ì „ ì„±ê³µ!\n\nâœ… ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸\nâœ… ì½ê¸° ê¶Œí•œ í™•ì¸\nâœ… ì“°ê¸° ê¶Œí•œ í™•ì¸\nâœ… ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ\n\nì´ì œ ì˜ˆì•½ ë°ì´í„°ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™”ë©ë‹ˆë‹¤!');
                    
                    // ì—°ê²° í›„ ìë™ìœ¼ë¡œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                    setTimeout(() => loadFromGoogleSheet(), 1000);
                } else {
                    throw new Error(`SAVE_TEST_FAILED: ${result.error || 'ì €ì¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨'}`);
                }
                
            } catch (error) {
                console.error('âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                
                isConnected = false;
                
                // ì˜¤ë¥˜ ìœ í˜•ë³„ ë§ì¶¤ ë©”ì‹œì§€
                let errorMessage = 'âŒ êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n';
                let errorType = 'UNKNOWN';
                
                if (error.name === 'AbortError' || error.message.includes('aborted')) {
                    errorType = 'TIMEOUT';
                    errorMessage += 'â° ì—°ê²° ì‹œê°„ ì´ˆê³¼ (15ì´ˆ)\n\n';
                    errorMessage += 'ğŸ” ê°€ëŠ¥í•œ ì›ì¸:\n';
                    errorMessage += 'â€¢ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ëŠë¦¼\n';
                    errorMessage += 'â€¢ Apps Script ì„œë²„ ì‘ë‹µ ì§€ì—°\n';
                    errorMessage += 'â€¢ ë°©í™”ë²½ì´ë‚˜ ë³´ì•ˆ í”„ë¡œê·¸ë¨ì´ ì°¨ë‹¨\n\n';
                    errorMessage += 'ğŸ’¡ í•´ê²° ë°©ë²•:\n';
                    errorMessage += 'â€¢ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„\n';
                    errorMessage += 'â€¢ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‹œë„\n';
                    errorMessage += 'â€¢ VPN ì‚¬ìš© ì¤‘ì´ë©´ í•´ì œ í›„ ì‹œë„\n';
                } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorType = 'NETWORK_BLOCKED';
                    errorMessage += 'ğŸš« ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n';
                    errorMessage += 'ğŸ”¥ ì´ê²ƒì€ ê°€ì¥ í”í•œ "Failed to fetch" ì˜¤ë¥˜ì…ë‹ˆë‹¤!\n\n';
                    errorMessage += 'ğŸ¯ ì£¼ìš” ì›ì¸:\n';
                    errorMessage += '1ï¸âƒ£ Apps Script ë°°í¬ ê¶Œí•œì´ ì˜ëª»ë¨ (90%)\n';
                    errorMessage += '2ï¸âƒ£ CORS ì •ì±… ìœ„ë°˜\n';
                    errorMessage += '3ï¸âƒ£ ë¸Œë¼ìš°ì € ë³´ì•ˆ ì„¤ì •\n\n';
                    
                    errorMessage += 'ğŸš¨ ê¸´ê¸‰ í•´ê²°ë²• (ìˆœì„œëŒ€ë¡œ!):\n\n';
                    errorMessage += 'ğŸ”§ 1ë‹¨ê³„: ê¸°ì¡´ ë°°í¬ ì™„ì „ ì‚­ì œ\n';
                    errorMessage += 'â€¢ Apps Script â†’ "ë°°í¬" â†’ "ë°°í¬ ê´€ë¦¬"\n';
                    errorMessage += 'â€¢ ê¸°ì¡´ ë°°í¬ ëª¨ë‘ ì‚­ì œ (ğŸ—‘ï¸ ì•„ì´ì½˜)\n';
                    errorMessage += 'â€¢ âš ï¸ ì´ ë‹¨ê³„ê°€ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤!\n\n';
                    
                    errorMessage += 'ğŸ”§ 2ë‹¨ê³„: ìƒˆ ë°°í¬ ìƒì„±\n';
                    errorMessage += 'â€¢ "ë°°í¬" â†’ "ìƒˆ ë°°í¬"\n';
                    errorMessage += 'â€¢ âš™ï¸ ì„¤ì • â†’ "ì›¹ ì•±" ì„ íƒ\n';
                    errorMessage += 'â€¢ ì‹¤í–‰ ê¶Œí•œ: "ë‚˜"\n';
                    errorMessage += 'â€¢ ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì" â­\n';
                    errorMessage += 'â€¢ "ë°°í¬" í´ë¦­\n\n';
                    
                    errorMessage += 'ğŸ”§ 3ë‹¨ê³„: ê¶Œí•œ ìŠ¹ì¸ (í•µì‹¬!)\n';
                    errorMessage += 'â€¢ "ì•±ì´ í™•ì¸ë˜ì§€ ì•ŠìŒ" â†’ "ê³ ê¸‰"\n';
                    errorMessage += 'â€¢ "ì•ˆì „í•˜ì§€ ì•Šì€ í˜ì´ì§€ë¡œ ì´ë™"\n';
                    errorMessage += 'â€¢ ëª¨ë“  ê¶Œí•œ "í—ˆìš©"\n';
                } else if (error.message.includes('PERMISSION_ERROR')) {
                    errorType = 'PERMISSION';
                    errorMessage += 'ğŸ”’ ê¶Œí•œ ì„¤ì • ë¬¸ì œ\n\n';
                    errorMessage += 'Apps Scriptê°€ HTML ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤.\n';
                    errorMessage += 'ì´ëŠ” ë°°í¬ ê¶Œí•œì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\n\n';
                    errorMessage += 'âœ… í•´ê²° ë°©ë²•:\n';
                    errorMessage += 'â€¢ ë°°í¬ ì‹œ "ì•¡ì„¸ìŠ¤ ê¶Œí•œ"ì„ "ëª¨ë“  ì‚¬ìš©ì"ë¡œ ì„¤ì •\n';
                    errorMessage += 'â€¢ ê¸°ì¡´ ë°°í¬ ì‚­ì œ í›„ ìƒˆë¡œ ë°°í¬\n';
                    errorMessage += 'â€¢ ê¶Œí•œ ìŠ¹ì¸ ê³¼ì •ì„ ì •í™•íˆ ì§„í–‰\n';
                } else if (error.message.includes('JSON_PARSE_ERROR')) {
                    errorType = 'CODE_ERROR';
                    errorMessage += 'ğŸ“ Apps Script ì½”ë“œ ë¬¸ì œ\n\n';
                    errorMessage += 'Apps Scriptì—ì„œ ì˜¬ë°”ë¥¸ JSONì„ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n';
                    errorMessage += 'âœ… í•´ê²° ë°©ë²•:\n';
                    errorMessage += 'â€¢ ì œê³µëœ ì½”ë“œë¥¼ ì •í™•íˆ ë³µì‚¬í–ˆëŠ”ì§€ í™•ì¸\n';
                    errorMessage += 'â€¢ Apps Scriptì—ì„œ ì½”ë“œ ì €ì¥ (Ctrl+S)\n';
                    errorMessage += 'â€¢ ìƒˆ ë°°í¬ ìƒì„±\n';
                } else if (error.message.includes('EMPTY_RESPONSE')) {
                    errorType = 'EMPTY_RESPONSE';
                    errorMessage += 'ğŸ“­ ë¹ˆ ì‘ë‹µ ì˜¤ë¥˜\n\n';
                    errorMessage += 'Apps Scriptê°€ ì•„ë¬´ê²ƒë„ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n';
                    errorMessage += 'âœ… í•´ê²° ë°©ë²•:\n';
                    errorMessage += 'â€¢ Apps Script ì½”ë“œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸\n';
                    errorMessage += 'â€¢ doGet, doPost í•¨ìˆ˜ê°€ ìˆëŠ”ì§€ í™•ì¸\n';
                    errorMessage += 'â€¢ ì½”ë“œ ì €ì¥ í›„ ìƒˆ ë°°í¬\n';
                } else {
                    errorMessage += `ğŸ” ì˜¤ë¥˜ ìƒì„¸: ${error.message}\n\n`;
                }
                
                // ê³µí†µ ì¶”ê°€ ë„ì›€ë§
                errorMessage += '\nğŸ“‹ ì¶”ê°€ ë„ì›€ë§:\n\n';
                errorMessage += 'ğŸŒ ë¸Œë¼ìš°ì €ë³„ í•´ê²°ë²•:\n';
                errorMessage += 'â€¢ Chrome: ì‹œí¬ë¦¿ ëª¨ë“œì—ì„œ ì‹œë„\n';
                errorMessage += 'â€¢ Firefox: ì¶”ì  ë°©ì§€ í•´ì œ\n';
                errorMessage += 'â€¢ Safari: ê°œë°œì ë©”ë‰´ì—ì„œ CORS í•´ì œ\n\n';
                
                errorMessage += 'ğŸ”§ ê³ ê¸‰ í•´ê²°ë²•:\n';
                errorMessage += 'â€¢ ë¸Œë¼ìš°ì € ìºì‹œ ì™„ì „ ì‚­ì œ\n';
                errorMessage += 'â€¢ ë‹¤ë¥¸ êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ì‹œë„\n';
                errorMessage += 'â€¢ ê°œë°œì ë„êµ¬(F12) â†’ ì½˜ì†” íƒ­ì—ì„œ ìƒì„¸ ì˜¤ë¥˜ í™•ì¸\n\n';
                
                errorMessage += 'ğŸ’¡ ì—¬ì „íˆ ì•ˆ ë˜ë©´:\n';
                errorMessage += 'â€¢ 30ë¶„ í›„ ë‹¤ì‹œ ì‹œë„ (êµ¬ê¸€ ì„œë²„ ë™ê¸°í™” ì‹œê°„)\n';
                errorMessage += 'â€¢ ë‹¤ë¥¸ ê¸°ê¸°/ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‹œë„\n';
                errorMessage += 'â€¢ êµ¬ê¸€ Apps Script ìƒíƒœ í˜ì´ì§€ í™•ì¸';
                
                showAlert(errorMessage);
                
                // ì—°ê²° ì‹¤íŒ¨ ìƒíƒœ í‘œì‹œ
                document.getElementById('connectionStatus').innerHTML = `âŒ ì—°ê²° ì‹¤íŒ¨ (${errorType}) - ë¡œì»¬ ì €ì¥ë§Œ ê°€ëŠ¥`;
                document.getElementById('connectionStatus').className = 'text-red-700 font-medium';
                
                // ì²´í¬ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
                document.getElementById('troubleshootingChecklist').style.display = 'block';
            }
        }

        // êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadFromGoogleSheet() {
            if (!isConnected || !googleSheetUrl) {
                showAlert('ë¨¼ì € êµ¬ê¸€ ì‹œíŠ¸ë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                showAlert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
                
                const response = await fetch(googleSheetUrl);
                const data = await response.json();
                
                // ë°ì´í„° íŒŒì‹±
                reservations = {};
                if (data && data.length > 0) {
                    data.forEach(row => {
                        if (row.length >= 3 && row[0] && row[1] && row[2]) {
                            const key = `${row[0]}_${row[1]}`;
                            reservations[key] = row[2];
                        }
                    });
                }
                
                // UI ì—…ë°ì´íŠ¸
                updateDateButtonColors();
                if (selectedDate) {
                    createTimeTable();
                }
                
                showAlert(`âœ… ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\nì´ ${Object.keys(reservations).length}ê°œì˜ ì˜ˆì•½`);
                
            } catch (error) {
                console.error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                showAlert('âŒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nURLì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // êµ¬ê¸€ ì‹œíŠ¸ì— ë°ì´í„° ì €ì¥
        async function saveToGoogleSheet() {
            if (!isConnected || !googleSheetUrl) {
                console.log('êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ì•ˆë¨ - ë¡œì»¬ ì €ì¥ë§Œ');
                return; // ì—°ê²°ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œì»¬ ì €ì¥ë§Œ
            }
            
            try {
                // ì˜ˆì•½ ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜
                const reservationArray = [];
                Object.keys(reservations).forEach(key => {
                    const parts = key.split('_');
                    const date = parts[0];
                    const time = parts[1];
                    const name = reservations[key];
                    reservationArray.push([date, time, name]);
                });
                
                const payload = {
                    reservations: reservationArray
                };
                
                console.log('êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥í•  ë°ì´í„°:', payload);
                console.log('ì €ì¥í•  URL:', googleSheetUrl);
                
                const response = await fetch(googleSheetUrl, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json, text/plain, */*'
                    },
                    body: JSON.stringify(payload)
                });
                
                console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
                console.log('ì‘ë‹µ í—¤ë”:', response.headers);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ê²°ê³¼:', result);
                
                if (result.success) {
                    console.log(`âœ… êµ¬ê¸€ ì‹œíŠ¸ì— ${result.saved || reservationArray.length}ê°œ ë°ì´í„° ì €ì¥ ì™„ë£Œ`);
                    
                    // ì €ì¥ ì„±ê³µ ì‹œ ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
                    document.getElementById('connectionStatus').innerHTML = 'âœ… êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²°ë¨ - ì‹¤ì‹œê°„ ë™ê¸°í™” ê°€ëŠ¥';
                    document.getElementById('connectionStatus').className = 'text-green-700 font-medium';
                } else {
                    throw new Error(result.error || 'ì €ì¥ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ì‹¤íŒ¨:', error);
                
                // ì—°ê²° ìƒíƒœë¥¼ ì‹¤íŒ¨ë¡œ ë³€ê²½
                isConnected = false;
                document.getElementById('connectionStatus').innerHTML = 'âŒ êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ì‹¤íŒ¨ - ë¡œì»¬ ì €ì¥ë§Œ ê°€ëŠ¥';
                document.getElementById('connectionStatus').className = 'text-red-700';
                
                showAlert('âš ï¸ êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\në¡œì»¬ì—ë§Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + error.message + '\n\nê´€ë¦¬ì ëª¨ë“œì—ì„œ ë‹¤ì‹œ ì—°ê²°í•´ë³´ì„¸ìš”.');
            }
        }

        // ë‚ ì§œë¥¼ yyyy-mm-dd í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
        function formatDateToYYYYMMDD(date) {
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }

        // ë‚ ì§œ ìƒì„± (8ì›” 10ì¼ ~ 9ì›” 2ì¼)
        function generateDates() {
            const dates = [];
            const startDate = new Date(2025, 7, 10); // 8ì›” 10ì¼ (ì›”ì€ 0ë¶€í„° ì‹œì‘)
            const endDate = new Date(2025, 8, 2);   // 9ì›” 2ì¼
            
            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            return dates;
        }

        // ë‚ ì§œ ë²„íŠ¼ ìƒì„±
        function createDateButtons() {
            const dateSelector = document.getElementById('dateSelector');
            const dates = generateDates();
            
            dates.forEach(date => {
                const dateStr = formatDateToYYYYMMDD(date);
                const button = document.createElement('button');
                button.setAttribute('data-date', dateStr);
                button.className = 'px-4 py-2 border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors';
                button.textContent = `${date.getMonth() + 1}/${date.getDate()}`;
                button.onclick = () => selectDate(dateStr, button);
                dateSelector.appendChild(button);
            });
        }

        // ì˜ˆì•½ ê°œìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ í´ë˜ìŠ¤ ë°˜í™˜ (ì´ˆë¡ìƒ‰ ê·¸ë¼ë°ì´ì…˜)
        function getReservationColorClass(count) {
            if (count === 0) return 'px-4 py-2 border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors';
            if (count === 1) return 'px-4 py-2 border border-green-200 bg-green-100 text-green-700 rounded-lg hover:bg-green-150 transition-colors';
            if (count === 2) return 'px-4 py-2 border border-green-300 bg-green-200 text-green-800 rounded-lg hover:bg-green-250 transition-colors';
            if (count === 3) return 'px-4 py-2 border border-green-400 bg-green-300 text-green-900 rounded-lg hover:bg-green-350 transition-colors';
            if (count === 4) return 'px-4 py-2 border border-green-500 bg-green-400 text-white rounded-lg hover:bg-green-450 transition-colors';
            return 'px-4 py-2 border border-green-600 bg-green-500 text-white rounded-lg hover:bg-green-550 transition-colors font-bold';
        }

        // íŠ¹ì • ë‚ ì§œì˜ ì˜ˆì•½ ê°œìˆ˜ ê³„ì‚°
        function getReservationCount(dateStr) {
            let count = 0;
            for (let hour = 10; hour <= 19; hour++) {
                const key = `${dateStr}_${hour}:00`;
                if (reservations[key]) {
                    count++;
                }
            }
            return count;
        }

        // ëª¨ë“  ë‚ ì§œ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
        function updateDateButtonColors() {
            document.querySelectorAll('#dateSelector button').forEach(button => {
                const dateStr = button.getAttribute('data-date');
                const count = getReservationCount(dateStr);
                const isSelected = dateStr === selectedDate;
                
                if (isSelected) {
                    button.className = 'px-4 py-2 border-2 border-blue-500 bg-blue-100 text-blue-700 rounded-lg font-medium';
                } else {
                    button.className = getReservationColorClass(count);
                }
            });
        }

        // ë‚ ì§œ ì„ íƒ
        function selectDate(dateStr, buttonElement) {
            selectedDate = dateStr;
            
            console.log('=== ë‚ ì§œ ì„ íƒ ë””ë²„ê¹… ===');
            console.log('ì…ë ¥ëœ dateStr:', dateStr);
            
            try {
                // ì™„ì „íˆ ìˆ˜ë™ìœ¼ë¡œ ë‚ ì§œ íŒŒì‹± (Date ê°ì²´ ì‚¬ìš© ì•ˆí•¨)
                const parts = dateStr.split('-');
                const year = parseInt(parts[0]);
                const month = parseInt(parts[1]);
                const day = parseInt(parts[2]);
                
                console.log('íŒŒì‹±ëœ ê°’ë“¤:', { year, month, day });
                
                // ìš”ì¼ ê³„ì‚°ë„ ìˆ˜ë™ìœ¼ë¡œ (Zeller's congruence ì•Œê³ ë¦¬ì¦˜)
                let m = month;
                let y = year;
                
                // 1ì›”ê³¼ 2ì›”ì€ ì „ë…„ë„ì˜ 13ì›”, 14ì›”ë¡œ ê³„ì‚°
                if (month <= 2) {
                    m = month + 12;
                    y = year - 1;
                }
                
                // Zeller's congruence ê³µì‹
                const q = day;
                const k = y % 100;
                const j = Math.floor(y / 100);
                
                const h = (q + Math.floor((13 * (m + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) - 2 * j) % 7;
                
                // ê²°ê³¼ë¥¼ ì¼ìš”ì¼=0 ê¸°ì¤€ìœ¼ë¡œ ë³€í™˜ (ZellerëŠ” í† ìš”ì¼=0ì´ë¯€ë¡œ ì¡°ì •)
                const dayOfWeek = (h + 6) % 7;
                
                const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                const koreanDayName = dayNames[dayOfWeek];
                
                console.log('ìˆ˜ë™ ê³„ì‚°ëœ ìš”ì¼ ì¸ë±ìŠ¤:', dayOfWeek);
                console.log('í•œêµ­ì–´ ìš”ì¼:', koreanDayName);
                
                // ë‚ ì§œ í‘œì‹œ - íŒŒì‹±ëœ ê°’ì„ ì§ì ‘ ì‚¬ìš©
                const displayText = `${month}ì›” ${day}ì¼ (${koreanDayName})`;
                console.log('ìµœì¢… í‘œì‹œ í…ìŠ¤íŠ¸:', displayText);
                
                document.getElementById('selectedDateDisplay').textContent = displayText;
                
            } catch (error) {
                console.error('ë‚ ì§œ íŒŒì‹± ì˜¤ë¥˜:', error);
                document.getElementById('selectedDateDisplay').textContent = `ë‚ ì§œ ì˜¤ë¥˜: ${dateStr}`;
            }
            
            console.log('=== ë‚ ì§œ ì„ íƒ ë””ë²„ê¹… ë ===');
            
            // ëª¨ë“  ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            updateDateButtonColors();
            
            createTimeTable();
        }

        // ì‹œê°„í‘œ ìƒì„±
        function createTimeTable() {
            const timeTable = document.getElementById('timeTable');
            timeTable.innerHTML = '';
            
            for (let hour = 10; hour <= 19; hour++) {
                const timeSlot = `${hour}:00`;
                const key = `${selectedDate}_${timeSlot}`;
                const reserver = reservations[key] || '';
                const isDisabled = disabledSlots[key];
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                if (isDisabled) {
                    // ë¹„í™œì„±í™”ëœ ê²½ìš°
                    row.innerHTML = `
                        <td class="border border-gray-300 px-4 py-2 font-medium text-gray-700">${timeSlot}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400 font-bold text-xl tracking-widest">
                                    ---
                                </span>
                                ${isAdminMode ? `
                                    <button onclick="toggleSlotDisabled('${timeSlot}')" 
                                            class="bg-green-100 hover:bg-green-200 text-green-800 px-3 py-1 rounded text-sm transition-colors">
                                        í™œì„±í™”
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                } else if (reserver) {
                    // ì˜ˆì•½ëœ ê²½ìš°
                    row.innerHTML = `
                        <td class="border border-gray-300 px-4 py-2 font-medium text-gray-700">${timeSlot}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            <div class="flex items-center justify-between">
                                <span class="text-blue-600 font-medium" id="reserver_${key}">
                                    ${reserver}
                                </span>
                                <div class="flex gap-2">
                                    <button onclick="openEditModal('${timeSlot}')" 
                                            class="bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-3 py-1 rounded text-sm transition-colors">
                                        ìˆ˜ì •/ì‚­ì œ
                                    </button>
                                    ${isAdminMode ? `
                                        <button onclick="toggleSlotDisabled('${timeSlot}')" 
                                                class="bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm transition-colors">
                                            ë¹„í™œì„±í™”
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </td>
                    `;
                } else {
                    // ì˜ˆì•½ ê°€ëŠ¥í•œ ê²½ìš°
                    row.innerHTML = `
                        <td class="border border-gray-300 px-4 py-2 font-medium text-gray-700">${timeSlot}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400" id="reserver_${key}">
                                    ì˜ˆì•½ ê°€ëŠ¥
                                </span>
                                <div class="flex gap-2">
                                    <button onclick="openReservationModal('${timeSlot}')" 
                                            class="bg-blue-100 hover:bg-blue-200 text-blue-800 px-3 py-1 rounded text-sm transition-colors">
                                        ì˜ˆì•½í•˜ê¸°
                                    </button>
                                    ${isAdminMode ? `
                                        <button onclick="toggleSlotDisabled('${timeSlot}')" 
                                                class="bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded text-sm transition-colors">
                                            ë¹„í™œì„±í™”
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </td>
                    `;
                }
                
                timeTable.appendChild(row);
            }
        }

        // ì˜ˆì•½ ëª¨ë‹¬ ì—´ê¸°
        function openReservationModal(timeSlot) {
            if (!selectedDate) {
                showAlert('ë¨¼ì € ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            selectedTimeSlot = timeSlot;
            document.getElementById('modalTimeSlot').textContent = `${selectedDate} ${timeSlot}`;
            document.getElementById('nameInput').value = '';
            
            // í•™ê¸‰ ì„ íƒ ì´ˆê¸°í™”
            document.getElementById('elementary').checked = false;
            document.getElementById('highschool').checked = false;
            
            document.getElementById('reservationModal').classList.remove('hidden');
            document.getElementById('reservationModal').classList.add('flex');
        }

        // ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ ì—´ê¸°
        function openEditModal(timeSlot) {
            if (!selectedDate) {
                showAlert('ë¨¼ì € ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            selectedTimeSlot = timeSlot;
            const key = `${selectedDate}_${timeSlot}`;
            const reserver = reservations[key];
            
            document.getElementById('currentReserver').textContent = reserver;
            document.getElementById('passwordInput').value = '';
            document.getElementById('newNameInput').value = '';
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        // ì˜ˆì•½ í™•ì¸
        async function confirmReservation() {
            const name = document.getElementById('nameInput').value.trim();
            const gradeRadios = document.getElementsByName('grade');
            let selectedGrade = '';
            
            // í•™ê¸‰ ì„ íƒ í™•ì¸
            for (let radio of gradeRadios) {
                if (radio.checked) {
                    selectedGrade = radio.value;
                    break;
                }
            }
            
            if (!selectedGrade) {
                showAlert('í•™ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!name) {
                showAlert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const key = `${selectedDate}_${selectedTimeSlot}`;
            reservations[key] = `${selectedGrade} - ${name}`;
            
            // ë¡œì»¬ ì €ì¥
            localStorage.setItem('reservations', JSON.stringify(reservations));
            
            // êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥
            await saveToGoogleSheet();
            
            closeModal();
            createTimeTable();
            updateDateButtonColors();
            showAlert('ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ì˜ˆì•½ ìˆ˜ì •
        async function updateReservation() {
            const password = document.getElementById('passwordInput').value;
            const newName = document.getElementById('newNameInput').value.trim();
            
            if (password !== PASSWORD) {
                showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!newName) {
                showAlert('ìƒˆ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const key = `${selectedDate}_${selectedTimeSlot}`;
            reservations[key] = newName;
            
            // ë¡œì»¬ ì €ì¥
            localStorage.setItem('reservations', JSON.stringify(reservations));
            
            // êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥
            await saveToGoogleSheet();
            
            closeEditModal();
            createTimeTable();
            updateDateButtonColors();
            showAlert('ì˜ˆì•½ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ì˜ˆì•½ ì‚­ì œ
        function deleteReservation() {
            const password = document.getElementById('passwordInput').value;
            
            if (password !== PASSWORD) {
                showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                return;
            }
            
            showConfirm('ì •ë§ë¡œ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async () => {
                const key = `${selectedDate}_${selectedTimeSlot}`;
                
                // ì˜ˆì•½ ë°ì´í„°ì—ì„œ ì‚­ì œ
                if (reservations[key]) {
                    delete reservations[key];
                    
                    // ë¡œì»¬ ì €ì¥
                    localStorage.setItem('reservations', JSON.stringify(reservations));
                    
                    // êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥
                    await saveToGoogleSheet();
                    
                    // ëª¨ë‹¬ ë‹«ê¸°ë¥¼ ë¨¼ì € ì‹¤í–‰
                    closeEditModal();
                    
                    // UI ì—…ë°ì´íŠ¸
                    createTimeTable();
                    updateDateButtonColors();
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    showAlert('ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    closeEditModal();
                    showAlert('ì‚­ì œí•  ì˜ˆì•½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            });
        }

        // ê´€ë¦¬ì ëª¨ë“œ í† ê¸€
        function toggleAdminMode() {
            document.getElementById('adminPasswordInput').value = '';
            document.getElementById('adminPasswordModal').classList.remove('hidden');
            document.getElementById('adminPasswordModal').classList.add('flex');
        }

        // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        function checkAdminPassword() {
            const password = document.getElementById('adminPasswordInput').value;
            
            if (password === PASSWORD) {
                isAdminMode = !isAdminMode;
                const adminBtn = document.getElementById('adminModeBtn');
                const googleSheetSection = document.getElementById('googleSheetSection');
                
                if (isAdminMode) {
                    adminBtn.textContent = 'ğŸ”“ ê´€ë¦¬ì ëª¨ë“œ (í™œì„±)';
                    adminBtn.className = 'bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg text-lg font-medium transition-colors';
                    googleSheetSection.style.display = 'block';
                } else {
                    adminBtn.textContent = 'ğŸ” ê´€ë¦¬ì ëª¨ë“œ';
                    adminBtn.className = 'bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg text-lg font-medium transition-colors';
                    googleSheetSection.style.display = 'none';
                }
                
                closeAdminPasswordModal();
                createTimeTable(); // ì‹œê°„í‘œ ë‹¤ì‹œ ìƒì„±
                showAlert(isAdminMode ? 'ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!' : 'ê´€ë¦¬ì ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹œê°„ëŒ€ ë¹„í™œì„±í™”/í™œì„±í™” í† ê¸€
        async function toggleSlotDisabled(timeSlot) {
            const key = `${selectedDate}_${timeSlot}`;
            
            if (disabledSlots[key]) {
                delete disabledSlots[key];
                showAlert('ì‹œê°„ëŒ€ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                createTimeTable();
            } else {
                // ì˜ˆì•½ì´ ìˆëŠ” ê²½ìš° í™•ì¸
                if (reservations[key]) {
                    showConfirm('ì´ ì‹œê°„ëŒ€ì— ì˜ˆì•½ì´ ìˆìŠµë‹ˆë‹¤. ì˜ˆì•½ì„ ì‚­ì œí•˜ê³  ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async () => {
                        delete reservations[key];
                        disabledSlots[key] = true;
                        
                        // ë¡œì»¬ ì €ì¥
                        localStorage.setItem('reservations', JSON.stringify(reservations));
                        localStorage.setItem('disabledSlots', JSON.stringify(disabledSlots));
                        
                        // êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥
                        await saveToGoogleSheet();
                        
                        updateDateButtonColors();
                        showAlert('ì˜ˆì•½ì´ ì‚­ì œë˜ê³  ì‹œê°„ëŒ€ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        createTimeTable();
                    });
                } else {
                    disabledSlots[key] = true;
                    localStorage.setItem('disabledSlots', JSON.stringify(disabledSlots));
                    showAlert('ì‹œê°„ëŒ€ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    createTimeTable();
                }
            }
        }

        // ì»¤ìŠ¤í…€ ì•Œë¦¼ í•¨ìˆ˜
        function showAlert(message) {
            // ê¸°ì¡´ ì•Œë¦¼ì´ ìˆë‹¤ë©´ ì œê±°
            const existingAlert = document.getElementById('customAlert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // ìƒˆ ì•Œë¦¼ ìƒì„±
            const alertDiv = document.createElement('div');
            alertDiv.id = 'customAlert';
            alertDiv.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md text-center';
            alertDiv.innerHTML = `
                <p class="whitespace-pre-line">${message}</p>
                <button onclick="this.parentElement.remove()" class="ml-4 text-blue-200 hover:text-white">âœ•</button>
            `;
            
            document.body.appendChild(alertDiv);
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // ì»¤ìŠ¤í…€ í™•ì¸ í•¨ìˆ˜
        function showConfirm(message, onConfirm) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.remove('hidden');
            document.getElementById('confirmModal').classList.add('flex');
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
            const yesBtn = document.getElementById('confirmYes');
            const noBtn = document.getElementById('confirmNo');
            
            const newYesBtn = yesBtn.cloneNode(true);
            const newNoBtn = noBtn.cloneNode(true);
            
            yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);
            noBtn.parentNode.replaceChild(newNoBtn, noBtn);
            
            newYesBtn.onclick = () => {
                closeConfirmModal();
                onConfirm();
            };
            
            newNoBtn.onclick = () => {
                closeConfirmModal();
            };
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.add('hidden');
            document.getElementById('confirmModal').classList.remove('flex');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('reservationModal').classList.add('hidden');
            document.getElementById('reservationModal').classList.remove('flex');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        }

        function closeAdminPasswordModal() {
            document.getElementById('adminPasswordModal').classList.add('hidden');
            document.getElementById('adminPasswordModal').classList.remove('flex');
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // 1. í™˜ê²½ ê°ì§€ ë° UI ì„¤ì •
            const isIndependent = detectEnvironmentAndSetupUI();
            
            // 2. ê¸°ë³¸ UI ìƒì„±
            createDateButtons();
            
            // 3. êµ¬ê¸€ ì‹œíŠ¸ URL ìë™ ì„¤ì •
            const defaultUrl = 'https://script.google.com/macros/s/AKfycbwJugsHhMWoZucgdyHY5m5RqVYkYglkxitYUZSfcPll9T3lk5tLdaUOSyZ7-8q5I6jN/exec';
            googleSheetUrl = defaultUrl;
            document.getElementById('googleSheetUrl').value = defaultUrl;
            localStorage.setItem('googleSheetUrl', defaultUrl);
            
            // 4. ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ë°±ì—…ìš©)
            const savedReservations = localStorage.getItem('reservations');
            const savedDisabledSlots = localStorage.getItem('disabledSlots');
            
            if (savedReservations) {
                reservations = JSON.parse(savedReservations);
            }
            
            if (savedDisabledSlots) {
                disabledSlots = JSON.parse(savedDisabledSlots);
            }
            
            updateDateButtonColors();
            
            // 5. ë…ë¦½ í™˜ê²½ì—ì„œë§Œ êµ¬ê¸€ ì‹œíŠ¸ ìë™ ì—°ê²°
            if (isIndependent) {
                console.log('ë…ë¦½ í™˜ê²½ - êµ¬ê¸€ ì‹œíŠ¸ ìë™ ì—°ê²° ì‹œì‘');
                setTimeout(() => {
                    connectGoogleSheet();
                }, 1000);
            } else {
                console.log('Canva í™˜ê²½ - êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ê±´ë„ˆëœ€ (ì œí•œëœ í™˜ê²½)');
                // Canva í™˜ê²½ì—ì„œëŠ” ì—°ê²° ìƒíƒœë¥¼ ì œí•œë¨ìœ¼ë¡œ í‘œì‹œ
                document.getElementById('connectionStatus').innerHTML = 'âš ï¸ Canva í™˜ê²½ - ì™¸ë¶€ ì—°ê²° ì œí•œë¨';
                document.getElementById('connectionStatus').className = 'text-orange-700 font-medium';
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('reservationModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeModal();
        });

        document.getElementById('editModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeEditModal();
        });

        document.getElementById('adminPasswordModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeAdminPasswordModal();
        });

        document.getElementById('confirmModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeConfirmModal();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'969c66aec5f0ea8f',t:'MTc1NDI5MzE2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
